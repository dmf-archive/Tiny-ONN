# Idea Note: FARS (Fisher-Aware Routing Shaping)

`Date: 2026-01-02`
`Status: Theoretical Proposal`

## 1. 背景：从 SARS 的局限性说起

**SARS (Surprise-Aware Routing Shaping)** 的核心思想是利用“意外”（Surprise，即预测误差的梯度）来动态调整路由器的先验分布。其目标是让路由器自发地将计算资源分配给最能减少自由能的路径。

然而，在实践中，直接使用参数梯度进行路由塑造面临以下挑战：

- **梯度噪声**：单次迭代的梯度包含大量瞬时噪声，导致路由抖动。
- **尺度不一致**：不同专家的梯度量级差异巨大，难以统一塑造。

## 2. 核心洞察：二阶矩即 Fisher 近似

在 **AdaRMSuon** 和 **ARS** 的开发过程中，我们确立了一个关键的二阶优化观点：
**Adam 的二阶矩估计 `v̂` 在数学上是 Fisher 信息矩阵 (FIM) 的对角近似。**

`F ≈ E[∇L ⊗ ∇L] ≈ v̂`

Fisher 信息衡量了参数空间中概率分布对参数变化的敏感度。在信息几何中，它定义了流形的度量。

## 3. FARS 构想：基于 Fisher 信息的路由塑造

**FARS (Fisher-Aware Routing Shaping)** 提议不再使用一阶梯度，而是使用**梯度方差（Fisher 近似）**来塑造路由。

### 3.1. 形式化逻辑

不再追踪 `∂L/∂θ` 的瞬时值，而是追踪路由决策对系统“认知确定性”的贡献：

1. **计算 Fisher 贡献**：对于每个专家/路由路径，计算其对应的二阶矩 `v_expert`。
2. **塑造路由先验**：
   `Prior_new = Softmax( Prior_old + α ⋅ log(v_expert + ε) )`

### 3.2. 为什么这更优？

- **稳定性**：二阶矩是梯度的移动平均平方，具有天然的平滑性，能提供更稳定的路由信号。
- **几何意义**：FARS 实际上是在寻找概率流形上“信息量最大”的路径。高 Fisher 值的路径代表了模型参数最敏感、学习最活跃的区域。
- **与 ARS 协同**：既然优化器已经在利用 `v̂` 进行测地线滑行，路由层同步利用 `v̂` 进行路径选择，实现了优化与架构在信息几何层面的完全对齐。

## 4. 结论：从“意外”到“价值”

SARS 关注的是“哪里错了”（梯度），而 FARS 关注的是“哪里重要”（Fisher 信息）。这标志着路由机制从单纯的误差驱动，转向了基于**信息价值 (Information Value)** 的主动推断。
